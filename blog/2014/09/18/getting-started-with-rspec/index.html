
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Getting Started With RSpec - Chris Callahan's Blog</title>
  <meta name="author" content="Chris Callahan">

  
  <meta name="description" content="RSpec is tool to test Ruby code using a very English-like syntax. RSpec is one of the most popular testing frameworks in the Ruby and Rails &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://callahanchris.github.io/blog/2014/09/18/getting-started-with-rspec">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Chris Callahan's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Chris Callahan's Blog</a></h1>
  
    <h2>Becoming a hacker.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:callahanchris.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="https://github.com/callahanchris" target="_blank">Github</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Getting Started With RSpec</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-09-18T11:56:23-04:00" pubdate data-updated="true">Sep 18<span>th</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>RSpec is tool to test Ruby code using a very English-like syntax. RSpec is one of the most popular testing frameworks in the Ruby and Rails communities today, along with minitest (the default testing framework used in Rails 4) and Test::Unit.</p>

<p>Testing is essential to writing reliable code. Not only does it establish a rapid feedback loop, but it also gives you the freedom to refactor your code to your heart&rsquo;s content while ensuring that the code retains its original functionality.</p>

<h3>How to Integrate RSpec Into Your App</h3>

<p>It&rsquo;s very easy to get started with RSpec. To download RSpec run</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>gem install rspec
</span></code></pre></td></tr></table></div></figure>


<p>In a Ruby app, you can get RSpec up and running with</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rspec --init
</span></code></pre></td></tr></table></div></figure>


<p>This will make a <code>.rspec</code> file in the root directory of the application and a <code>spec/</code> directory containing a <code>spec_helper.rb</code> file.</p>

<p>To get RSpec integrated into a Rails app, add the following code to the <code>Gemfile</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">group</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>and run <code>bundle install</code> to install the RSpec gems in the Rails app. Then run the following command to create the <code>.rspec</code> and <code>spec/spec_helper.rb</code> files:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rails generate rspec:install
</span></code></pre></td></tr></table></div></figure>


<p>Because Rails autogenerates a test suite through the <code>rails new</code> command, it can also be helpful to tell Rails to not include these files with the <code>-T</code> flag when creating a new app.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rails new greatest_app_ever -T
</span></code></pre></td></tr></table></div></figure>


<p>Now that RSpec is installed, you can run your specs from the command line with <code>rspec</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rspec
</span><span class='line'>No examples found.
</span><span class='line'>
</span><span class='line'>Finished in 0.00037 seconds <span class="o">(</span>files took 0.11253 seconds to load<span class="o">)</span>
</span><span class='line'>0 examples, 0 failures
</span></code></pre></td></tr></table></div></figure>


<h3>Structuring a Spec File</h3>

<p>Let&rsquo;s say I want to write a basic Ruby app that will keep track of some different espresso-based beverages. Here&rsquo;s the file directory structure after running <code>rspec --init</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>espresso-maker/
</span><span class='line'>|
</span><span class='line'>|__ lib/
</span><span class='line'>|   |
</span><span class='line'>|   |__ espresso.rb
</span><span class='line'>|
</span><span class='line'>|__ spec/
</span><span class='line'>|   |
</span><span class='line'>|   |__ spec_helper.rb
</span><span class='line'>|
</span><span class='line'>|__ .rspec
</span></code></pre></td></tr></table></div></figure>


<p>So far these files are pretty empty. Here&rsquo;s <code>espresso.rb</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Espresso</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I want to take a test-first approach to this app, so I&rsquo;ll go ahead and set up a spec file to test the <code>Espresso</code> class. Any file that ends in <code>_spec.rb</code> will be run by the <code>rspec</code> command, but it is best to name the spec files in the <code>model_name_spec.rb</code> format. In the <code>spec</code> directory, I made an <code>espresso_spec.rb</code> file to house all the tests I&rsquo;ll write for the <code>Espresso</code> model.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">require_relative</span> <span class="s1">&#39;spec_helper&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">describe</span> <span class="no">Espresso</span> <span class="k">do</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>At the top of the <code>espresso_spec.rb</code> file, I required the <code>spec_helper.rb</code> file, where I will list all of the file dependencies so that they don&rsquo;t clutter up this spec file. Then I opened a <code>describe</code> block for the <code>Espresso</code> class &ndash; all of the tests in this file should go inside this block. Note that it&rsquo;s OK to use the constant <code>Espresso</code> in this case, but generally you will pass in a string as an argument to the RSpec methods <code>describe</code>, <code>context</code>, and <code>it</code>.</p>

<p>In order for the tests to run properly, I also need to add the following line to the <code>spec/spec_helper.rb</code> file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">require_relative</span> <span class="s1">&#39;../lib/espresso&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Without this <code>require_relative</code> statement, RSpec will not understand what <code>Espresso</code> is and will throw an uninitialized constant NameError.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="no">Espresso</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">describe</span> <span class="s1">&#39;#name&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">describe</span> <span class="s1">&#39;#ingredients&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">describe</span> <span class="s1">&#39;.country_of_origin&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Inside the <code>describe Espresso</code> block, I opened a <code>describe</code> block for each public method that will be part of <code>Espresso</code>&rsquo;s API. These method-specific <code>describe</code> blocks should use the <code>#method_name</code> notation for instance methods and the <code>.method_name</code> notation for class methods.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="no">Espresso</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">describe</span> <span class="s1">&#39;#name&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">it</span> <span class="s1">&#39;is espresso&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">describe</span> <span class="s1">&#39;#ingredients&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">it</span> <span class="s1">&#39;one part espresso&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">describe</span> <span class="s1">&#39;.country_of_origin&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">it</span> <span class="s1">&#39;is from Kenya&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Within each <code>describe</code> block, I can open <code>it</code> blocks that will contain the actual expectations to be tested. <code>it</code> takes a terse (less than 40 characters) description of the specific expectation I&rsquo;m setting on the method for this test as an argument.</p>

<p>Inside of <code>it</code> blocks, the RSpec 3 syntax uses the <code>expect</code> method to set up an expectation.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">expect</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>In general, you pass an expression to be evaluated to the <code>expect</code> method and chain <code>to</code> to the end of this method. Then you call a matcher method and pass in the value you expect the argument passed to <code>expect</code> to evaluate to. Some of the most common RSpec matcher methods are <code>eq</code>, <code>include</code>, <code>match</code>, and <code>respond_to</code>, all of which closely correspond to Ruby methods.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">expect</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="kp">include</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;Hello world, my name is Chris!&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">match</span><span class="p">(</span><span class="sr">/Hello world/</span><span class="p">)</span>
</span><span class='line'><span class="n">expect</span><span class="p">(</span><span class="s2">&quot;an ordinary string&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">respond_to</span><span class="p">(</span><span class="ss">:upcase</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Writing the Specs</h3>

<p>Now it&rsquo;s time to write our first test!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="no">Espresso</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">describe</span> <span class="s1">&#39;#name&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">it</span> <span class="s1">&#39;is espresso&#39;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">espresso</span> <span class="o">=</span> <span class="no">Espresso</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>      <span class="n">expect</span><span class="p">(</span><span class="n">espresso</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">&quot;espresso&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we&rsquo;re instantiating a new <code>Espresso</code> object and setting up an expectation that the <code>#name</code> method will return the value &ldquo;espresso&rdquo; when it is sent to an instance of the <code>Espresso</code> class. We run <code>rspec</code> and the test fails.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rspec
</span><span class='line'>
</span><span class='line'>Espresso
</span><span class='line'>  <span class="c">#name</span>
</span><span class='line'>    is espresso <span class="o">(</span>FAILED - 1<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Failures:
</span><span class='line'>
</span><span class='line'>  1<span class="o">)</span> Espresso#name is espresso
</span><span class='line'>     Failure/Error: expect<span class="o">(</span>espresso.name<span class="o">)</span>.to eq<span class="o">(</span><span class="s2">&quot;espresso&quot;</span><span class="o">)</span>
</span><span class='line'>     NoMethodError:
</span><span class='line'>       undefined method <span class="sb">`</span>name<span class="s1">&#39; for #&lt;Espresso:0x00000103131178&gt;</span>
</span><span class='line'><span class="s1">     # ./spec/espresso_spec.rb:7:in `block (3 levels) in &lt;top (required)&gt;&#39;</span>
</span><span class='line'>
</span><span class='line'>Finished in 0.00057 seconds <span class="o">(</span>files took 0.11633 seconds to load<span class="o">)</span>
</span><span class='line'>1 example, 1 failure
</span><span class='line'>
</span><span class='line'>Failed examples:
</span><span class='line'>
</span><span class='line'>rspec ./spec/espresso_spec.rb:5 <span class="c"># Espresso#name is espresso</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now the cycle of &ldquo;Red, Green, Refactor&rdquo; can begin. We have a failing (red) test, now let&rsquo;s do the minimum possible work to get the test to pass (green). Once we have green tests, then we can mercilessly refactor while ensuring the tests stay green, and thus the functionality of the code stays the same.</p>

<p>Based on the error message above, I know the first step should be adding a <code>name</code> method to the <code>Espresso</code> class.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Espresso</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">name</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Running <code>rspec</code> again gives a bit more guidance about what the <code>name</code> method should return:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Failures:
</span><span class='line'>
</span><span class='line'>  1<span class="o">)</span> Espresso#name is espresso
</span><span class='line'>     Failure/Error: expect<span class="o">(</span>espresso.name<span class="o">)</span>.to eq<span class="o">(</span><span class="s2">&quot;espresso&quot;</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>       expected: <span class="s2">&quot;espresso&quot;</span>
</span><span class='line'>            got: nil
</span><span class='line'>
</span><span class='line'>       <span class="o">(</span>compared <span class="nv">using</span> <span class="o">==)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s make the test go green!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Espresso</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">name</span>
</span><span class='line'>    <span class="s2">&quot;espresso&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rspec
</span><span class='line'>
</span><span class='line'>Espresso
</span><span class='line'>  <span class="c">#name</span>
</span><span class='line'>    is espresso
</span><span class='line'>
</span><span class='line'>Finished in 0.00158 seconds <span class="o">(</span>files took 0.12372 seconds to load<span class="o">)</span>
</span><span class='line'>1 example, 0 failures
</span></code></pre></td></tr></table></div></figure>


<p>Success!</p>

<h3>Introducing <code>context</code>s</h3>

<p>Now I want to have the <code>#name</code> method return different results depending on whether or not the espresso has milk in it. I could just write a new <code>it '...'</code> expectation inside of the <code>describe "#name"</code> block, but this might get unwieldy in short order. Namespacing is important to writing readable, easy-to-follow tests. If there are many facets of a method to be tested, we can group the nested <code>it</code> blocks inside of <code>context</code> blocks.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="no">Espresso</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">describe</span> <span class="s1">&#39;#name&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">context</span> <span class="s1">&#39;without milk&#39;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">it</span> <span class="s1">&#39;is espresso&#39;</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">espresso</span> <span class="o">=</span> <span class="no">Espresso</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>        <span class="n">expect</span><span class="p">(</span><span class="n">espresso</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">&quot;espresso&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">context</span> <span class="s1">&#39;with milk&#39;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">it</span> <span class="s1">&#39;is macchiato&#39;</span> <span class="k">do</span>
</span><span class='line'>        <span class="n">espresso</span> <span class="o">=</span> <span class="no">Espresso</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>        <span class="n">espresso</span><span class="o">.</span><span class="n">add_milk</span>
</span><span class='line'>        <span class="n">expect</span><span class="p">(</span><span class="n">espresso</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s2">&quot;macchiato&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here I&rsquo;ve written two <code>context</code> blocks, one for an espresso with milk and one for an espresso without milk. In order to get the milk into the espresso, I&rsquo;ve also included an <code>add_milk</code> method &mdash; this should also be tested as part of <code>Espresso</code>&rsquo;s API. Before getting the next test to pass, I fleshed out the <code>Espresso</code> class a bit to support this new method.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Espresso</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>    <span class="vi">@milk</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">name</span>
</span><span class='line'>    <span class="s2">&quot;espresso&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">add_milk</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">.</span><span class="n">milk</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>    <span class="kp">attr_accessor</span> <span class="ss">:milk</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">has_milk?</span>
</span><span class='line'>      <span class="n">milk</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The RSpec failure for the second test then read:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Failures:
</span><span class='line'>
</span><span class='line'>  1<span class="o">)</span> Espresso#name with milk is macchiato
</span><span class='line'>     Failure/Error: expect<span class="o">(</span>espresso.name<span class="o">)</span>.to eq<span class="o">(</span><span class="s2">&quot;macchiato&quot;</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>       expected: <span class="s2">&quot;macchiato&quot;</span>
</span><span class='line'>            got: <span class="s2">&quot;espresso&quot;</span>
</span><span class='line'>
</span><span class='line'>       <span class="o">(</span>compared <span class="nv">using</span> <span class="o">==)</span>
</span></code></pre></td></tr></table></div></figure>


<p>In order to get this test to pass, I implemented the simplest change possible to the <code>name</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">name</span>
</span><span class='line'>  <span class="n">has_milk?</span> <span class="p">?</span> <span class="s2">&quot;macchiato&quot;</span> <span class="p">:</span> <span class="s2">&quot;espresso&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>then ran <code>rspec</code> and enjoyed the nicely namespaced RSpec output:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rspec
</span><span class='line'>
</span><span class='line'>Espresso
</span><span class='line'>  <span class="c">#name</span>
</span><span class='line'>    without milk
</span><span class='line'>      is espresso
</span><span class='line'>    with milk
</span><span class='line'>      is macchiato
</span><span class='line'>
</span><span class='line'>Finished in 0.00147 seconds <span class="o">(</span>files took 0.12149 seconds to load<span class="o">)</span>
</span><span class='line'>2 examples, 0 failures
</span></code></pre></td></tr></table></div></figure>


<p>Going forward, I could also add <code>context</code>s for things like &ldquo;without ice&rdquo; and &ldquo;with ice&rdquo;.</p>

<h3>Next Steps</h3>

<p>This is a basic introduction to writing the first few tests of a Ruby app with RSpec, and is far from a complete resource. Already we can see that there is some repetition in the tests above (<code>espresso = Espresso.new</code>) that should be abstracted out. RSpec has a number of convenient methods to help you DRY out your tests, such as <code>let</code>, <code>before</code>, <code>subject</code>, and <code>it_behaves_like</code>. There&rsquo;s also clearly some more refactoring that can be done on the code itself &mdash; but now we have a safety net to fall back on when we start refactoring.</p>

<p>For more comprehensive info about RSpec, check out the resources below!</p>

<h3>Resources</h3>

<ul>
<li><p><a href="https://www.relishapp.com/rspec">Official RSpec Documentation</a></p></li>
<li><p><a href="http://betterspecs.org/">Better Specs</a> &ndash; A collection of RSpec best practices</p></li>
<li><p><a href="https://www.codeschool.com/courses/testing-with-rspec">Testing with RSpec on Code School</a> &ndash; Still uses the RSpec 2 <code>should</code> syntax, but otherwise a great intro to RSpec.</p></li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Chris Callahan</span></span>

      








  


<time datetime="2014-09-18T11:56:23-04:00" pubdate data-updated="true">Sep 18<span>th</span>, 2014</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://callahanchris.github.io/blog/2014/09/18/getting-started-with-rspec/" data-via="" data-counturl="http://callahanchris.github.io/blog/2014/09/18/getting-started-with-rspec/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/09/13/china-map-project-part-4-introducing-polymorphism/" title="Previous Post: China Map Project - Part 4: Introducing Polymorphism">&laquo; China Map Project - Part 4: Introducing Polymorphism</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/09/18/getting-started-with-rspec/">Getting Started With RSpec</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/13/china-map-project-part-4-introducing-polymorphism/">China Map Project - Part 4: Introducing Polymorphism</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/12/china-map-project-part-3-refactoring-using-replace-method-with-method-object/">China Map Project - Part 3: Refactoring Using Replace Method With Method Object</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/11/china-map-project-part-2-bringing-the-map-to-life-with-jvectormap/">China Map Project - Part 2: Bringing the Map to Life With jVectorMap</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/11/china-map-project-part-1-nokogiri/">China Map Project - Part 1: Nokogiri, Regular Expressions, and a JSON API</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Chris Callahan -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
